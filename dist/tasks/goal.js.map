{"version":3,"sources":["../../src/tasks/goal.js"],"names":["taskDefns","bustedTasks","fromArray","arr","defineTasks","defns","busted","create","tasks","projectDir","mode","goal","length","name","Array","err","error","stack","Promise","all","map","task"],"mappings":";;;;;;;AAMA;;;;AACA;;;;AACA;;;;AACA;;;;;;AATA;;;;;;AAWA,IAAIA,SAAJ;AACA,IAAIC,WAAJ;;AAEA,SAASC,SAAT,CAAoBC,GAApB,EAAyB;AACvB,MAAIA,IAAI,CAAJ,MAAW,UAAf,EAA2B;AACzB,WAAO,wBAAeA,IAAI,CAAJ,CAAf,CAAP;AACD;;AAED,SAAO,qBAAYA,IAAI,CAAJ,CAAZ,CAAP;AACD;;AAEM,MAAMC,oCAAc,CAACC,KAAD,EAAQC,MAAR,KAAmB;AAC5CN,cAAYK,KAAZ;AACAJ,gBAAcK,MAAd;;AAEA,kBAAYF,WAAZ,CAAwBC,KAAxB,EAA+BC,MAA/B;AACA,qBAAeF,WAAf,CAA2BC,KAA3B,EAAkCC,MAAlC;AACD,CANM;;AAQA,MAAMC,0BAAS,CAACC,KAAD,EAAQC,UAAR,EAAoBC,OAAO,OAA3B,KAAuC;AAC3D,MAAIC,IAAJ;;AAEA,MAAIH,MAAMI,MAAN,KAAiB,CAArB,EAAwB;AACtB,QAAIC,OAAOL,MAAM,CAAN,CAAX;AACAG,WAAOX,UAAUQ,MAAM,CAAN,CAAV,CAAP;;AAEA,QAAIG,gBAAgBG,KAApB,EAA2B;AACzBH,aAAOT,UAAUS,IAAV,CAAP;AACD;;AAEDA,WAAO,CAAC,YAAY;AAClB,UAAI;AACF,cAAMA,KAAKD,IAAL,EAAWG,IAAX,EAAiBJ,UAAjB,EAA6B,CAAC,CAACR,YAAYY,IAAZ,CAA/B,CAAN;AACD,OAFD,CAEE,OAAOE,GAAP,EAAY;AACZ,2BAAc,QAAOF,IAAK,EAA1B,EAA6BG,KAA7B,CAAmCD,OAAOA,IAAIE,KAAX,GAAmBF,IAAIE,KAAvB,GAA+BF,GAAlE;AACA,cAAO,eAAP;AACD;AACF,KAPM,GAAP;AAQD,GAhBD,MAgBO;AACLJ,WAAOO,QAAQC,GAAR,CAAYX,MAAMY,GAAN,CAAU,MAAMP,IAAN,IAAc;AACzC,UAAIQ,OAAOrB,UAAUa,IAAV,CAAX;;AAEA,UAAIQ,gBAAgBP,KAApB,EAA2B;AACzBO,eAAOnB,UAAUmB,IAAV,CAAP;AACD;;AAED,UAAI;AACF,cAAMA,KAAKX,IAAL,EAAWG,IAAX,EAAiBJ,UAAjB,EAA6B,CAAC,CAACR,YAAYY,IAAZ,CAA/B,CAAN;AACD,OAFD,CAEE,OAAOE,GAAP,EAAY;AACZ,2BAAc,QAAOF,IAAK,EAA1B,EAA6BG,KAA7B,CAAmCD,IAAIE,KAAJ,IAAaF,GAAhD;AACA,cAAO,eAAP;AACD;AACF,KAbkB,CAAZ,CAAP;AAcD;;AAED,SAAOJ,IAAP;AACD,CArCM","file":"goal.js","sourcesContent":["/**\n * @file src/tasks/mgr.js\n * @license MIT\n * @copyright 2017 10244872 Canada Inc.\n */\n\nimport createWatch from './watch'\nimport createSteps from './steps'\nimport createLogger from '../utils/log'\nimport createParallel from './parallel'\n\nlet taskDefns\nlet bustedTasks\n\nfunction fromArray (arr) {\n  if (arr[0] === 'parallel') {\n    return createParallel(arr[1])\n  }\n\n  return createWatch(arr[1])\n}\n\nexport const defineTasks = (defns, busted) => {\n  taskDefns = defns\n  bustedTasks = busted\n\n  createSteps.defineTasks(defns, busted)\n  createParallel.defineTasks(defns, busted)\n}\n\nexport const create = (tasks, projectDir, mode = 'start') => {\n  let goal\n\n  if (tasks.length === 1) {\n    let name = tasks[0]\n    goal = taskDefns[tasks[0]]\n\n    if (goal instanceof Array) {\n      goal = fromArray(goal)\n    }\n\n    goal = (async () => {\n      try {\n        await goal[mode](name, projectDir, !!bustedTasks[name])\n      } catch (err) {\n        createLogger(`hopp:${name}`).error(err && err.stack ? err.stack : err)\n        throw ('Build failed.')\n      }\n    })()\n  } else {\n    goal = Promise.all(tasks.map(async name => {\n      let task = taskDefns[name]\n\n      if (task instanceof Array) {\n        task = fromArray(task)\n      }\n\n      try {\n        await task[mode](name, projectDir, !!bustedTasks[name])\n      } catch (err) {\n        createLogger(`hopp:${name}`).error(err.stack || err)\n        throw ('Build failed.')\n      }\n    }))\n  }\n\n  return goal\n}\n"]}