{"version":3,"sources":["../src/hopp.js"],"names":["require","debug","normalize","name","normalized","i","length","toUpperCase","directory","type","indexOf","plugName","prototype","hasOwnProperty","Error","d","stack","push","slice","call","arguments","preset","resolve","substack","apply","forEach","row","init","src","all","steps","watch"],"mappings":";;;;;;;;AAMA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;2cAXA;;;;;;eAakBA,QAAQ,aAAR,EAAuB,MAAvB,C;IAAVC,K,YAAAA,K;;AAER;;;;;;AAIA,SAASC,SAAT,CAAoBC,IAApB,EAA0B;AACxB,MAAIC,aAAa,EAAjB;;AAEA,OAAK,IAAIC,IAAI,EAAb,EAAiBA,IAAIF,KAAKG,MAA1B,EAAkCD,KAAK,CAAvC,EAA0C;AACxCD,kBAAcD,KAAKE,CAAL,MAAY,GAAZ,GAAkBF,KAAKE,GAAL,EAAUE,WAAV,EAAlB,GAA4CJ,KAAKE,CAAL,CAA1D;AACD;;AAED,SAAOD,UAAP;AACD;;AAED;;;;;uDAGe,iBAAMI,SAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACb,aADa;AAAA,mBACL,2BAAYA,SAAZ,CADK;;AAAA;AAAA,0BAC2B,gBAAQ;AAC9C,kBAAMC,OAAON,KAAKO,OAAL,CAAa,QAAb,MAA2B,CAAC,CAA5B,GAAgC,QAAhC,GAA2C,QAAxD;AACA,kBAAMC,WAAWT,UAAUC,IAAV,CAAjB;;AAEAF,oBAAM,oBAAN,EAA4BQ,IAA5B,EAAkCN,IAAlC,EAAwCQ,QAAxC;;AAEA;AACA,kBAAI,cAAKC,SAAL,CAAeC,cAAf,CAA8BF,QAA9B,CAAJ,EAA6C;AAC3C,sBAAM,IAAIG,KAAJ,kBAAyBL,IAAzB,UAAkCN,IAAlC,UAA2CQ,QAA3C,sBAAN;AACD;;AAED;AACA;AACA,4BAAKC,SAAL,CAAeD,QAAf,IAA2B,YAAY;AAAA;;AACrC;AACA;AACA;AACA;;AAEA,oBAAIF,SAAS,QAAb,EAAuB;AACrB,uBAAKM,CAAL,CAAOC,KAAP,CAAaC,IAAb,CAAkB,CAChBd,IADgB,EAEhB,GAAGe,KAAH,CAASC,IAAT,CAAcC,SAAd,CAFgB,CAAlB;AAID,iBALD,MAKO;AACL,sBAAMC,SAASrB,QAAQ,eAAKsB,OAAL,CAAad,SAAb,EAAwB,cAAxB,EAAwCL,IAAxC,CAAR,CAAf;AACA,sBAAMoB,WAAWF,OAAOG,KAAP,CAAa,IAAb,EAAmBJ,SAAnB,CAAjB;;AAEAG,2BAASE,OAAT,CAAiB,eAAO;AAAA,8CACPC,GADO;AAAA,wBACfvB,IADe;;AAGtB,wBAAIA,KAAK,CAAL,MAAY,GAAhB,EAAqB;AACnB,4BAAKY,CAAL,CAAOC,KAAP,CAAaC,IAAb,CAAkBS,GAAlB;AACD,qBAFD,MAEO;AACL,4BAAKvB,IAAL,EAAWqB,KAAX,QAAuBE,IAAI,CAAJ,CAAvB;AACD;AACF,mBARD;AASD;;AAED,uBAAO,IAAP;AACD,eA3BD;AA4BD,aA1CY;;AAAA,0BACmBD,OADnB;;AA4Cb;;;AAGME,gBA/CO,GA+CA,SAAPA,IAAO;AAAA,qBAAO,kBAASC,GAAT,CAAP;AAAA,aA/CA;;AAiDbD,iBAAKE,GAAL;AACAF,iBAAKG,KAAL;AACAH,iBAAKI,KAAL;;AAnDa,6CAqDNJ,IArDM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","file":"hopp.js","sourcesContent":["/**\n * @file src/hopp.js\n * @license MIT\n * @copyright 2017 10244872 Canada Inc..\n */\n\nimport path from 'path'\nimport Hopp from './tasks/mgr'\nimport createSteps from './tasks/steps'\nimport createWatch from './tasks/watch'\nimport loadPlugins from './tasks/loadPlugins'\nimport createParallel from './tasks/parallel'\n\nconst { debug } = require('./utils/log')('hopp')\n\n/**\n * Normalizes a plugin/preset name to be added to\n * the prototype.\n */\nfunction normalize (name) {\n  let normalized = ''\n\n  for (let i = 12; i < name.length; i += 1) {\n    normalized += name[i] === '-' ? name[i++].toUpperCase() : name[i]\n  }\n\n  return normalized\n}\n\n/**\n * Create hopp object based on plugins.\n */\nexport default async directory => {\n  ;(await loadPlugins(directory)).forEach(name => {\n    const type = name.indexOf('plugin') !== -1 ? 'plugin' : 'preset'\n    const plugName = normalize(name)\n\n    debug('adding %s %s as %s', type, name, plugName)\n\n    // check for conflicts\n    if (Hopp.prototype.hasOwnProperty(plugName)) {\n      throw new Error(`Conflicting ${type}: ${name} (${plugName} already exists)`)\n    }\n\n    // add the plugin to the hopp prototype so it can be\n    // used for the rest of the build process\n    Hopp.prototype[plugName] = function () {\n      // instead of actually loading the plugin at this stage,\n      // we will just pop its call into our internal call stack\n      // for use later. this is useful when we are stepping through\n      // an entire hoppfile but might only be running a single task\n\n      if (type === 'plugin') {\n        this.d.stack.push([\n          name,\n          [].slice.call(arguments)\n        ])\n      } else {\n        const preset = require(path.resolve(directory, 'node_modules', name))\n        const substack = preset.apply(null, arguments)\n\n        substack.forEach(row => {\n          const [name] = row\n\n          if (name[0] === '/') {\n            this.d.stack.push(row)\n          } else {\n            this[name].apply(this, row[1])\n          }\n        })\n      }\n\n      return this\n    }\n  })\n\n  /**\n   * Expose hopp class for task creation.\n   */\n  const init = src => new Hopp(src)\n\n  init.all = createParallel\n  init.steps = createSteps\n  init.watch = createWatch\n\n  return init\n}\n"]}