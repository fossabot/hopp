{"version":3,"sources":["../lib/index.js"],"names":["require","fs","path","babel","config","mode","ctx","data","args","length","Error","filerelative","relative","dirname","dest","file","options","Object","assign","filename","basename","filenameRelative","sourceFileName","sourceMapTarget","output","transform","body","sourceMaps","Promise","resolve","reject","writeFile","JSON","stringify","map","err","code"],"mappings":";;;;;;;;AAAA;;;;;AAKAA,QAAQ,6BAAR;;AAEA,IAAMC,KAAKD,QAAQ,IAAR,CAAX;AACA,IAAME,OAAOF,QAAQ,MAAR,CAAb;AACA,IAAMG,QAAQH,QAAQ,YAAR,CAAd;;AAEA;;;AAGO,IAAMI,0BAAS;AACpBC,QAAM;;AAGR;;;AAJsB,CAAf;;uDAOQ,iBAAOC,GAAP,EAAYC,IAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACTD,IAAIE,IAAJ,CAASC,MAAT,GAAkB,CADT;AAAA;AAAA;AAAA;;AAAA,kBAEL,IAAIC,KAAJ,CAAU,iCAAV,CAFK;;AAAA;;AAKb;;;AAGMC,wBARO,GAQQT,KAAKU,QAAL,CAAcV,KAAKW,OAAL,CAAaN,KAAKO,IAAlB,CAAd,EAAuCP,KAAKQ,IAA5C,CARR;AASPC,mBATO,GASGC,OAAOC,MAAP,CAAc,EAAd,EAAkBZ,IAAIE,IAAJ,CAAS,CAAT,KAAe,EAAjC,EAAqC;AACnDW,wBAAUjB,KAAKkB,QAAL,CAAcb,KAAKQ,IAAnB,CADyC;AAEnDM,gCAAkBV,YAFiC;AAGnDW,8BAAgBX,YAHmC;AAInDY,+BAAiBZ;AAJkC,aAArC,CATH;;AAgBb;;;;AAGMa,kBAnBO,GAmBErB,MAAMsB,SAAN,CAAgBlB,KAAKmB,IAArB,EAA2BV,OAA3B,CAnBF;;AAqBb;;;;AArBa,iBAwBTA,QAAQW,UAxBC;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAyBL,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrC7B,iBAAG8B,SAAH,CAAaxB,KAAKO,IAAL,GAAY,MAAzB,EAAiCkB,KAAKC,SAAL,CAAeT,OAAOU,GAAtB,CAAjC,EAA6D,eAAO;AAClE,oBAAIC,GAAJ,EAASL,OAAOK,GAAP,EAAT,KACKN;AACN,eAHD;AAID,aALK,CAzBK;;AAAA;;AAiCb;;;AAGAtB,iBAAKmB,IAAL,GAAYF,OAAOY,IAAnB;;AAEA;;;AAGA,gBAAIpB,QAAQW,UAAZ,EAAwB;AACtBpB,mBAAKmB,IAAL,IAAc,4BAA2BxB,KAAKkB,QAAL,CAAcb,KAAKO,IAAnB,CAAyB,MAAlE;AACD;;AAED;;;AA7Ca,6CAgDNP,IAhDM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","file":"../lib/index.js","sourcesContent":["/**\n * @file index.src.js\n * @license MIT\n */\n\nrequire('regenerator-runtime/runtime')\n\nconst fs = require('fs')\nconst path = require('path')\nconst babel = require('babel-core')\n\n/**\n * Buffering is needed for babel.\n */\nexport const config = {\n  mode: 'buffer'\n}\n\n/**\n * Proxy babel-core.\n */\nexport default async (ctx, data) => {\n  if (ctx.args.length > 1) {\n    throw new Error('Unexpected number of arguments.')\n  }\n\n  /**\n   * Add file metadata to babel options.\n   */\n  const filerelative = path.relative(path.dirname(data.dest), data.file)\n  const options = Object.assign({}, ctx.args[0] || {}, {\n    filename: path.basename(data.file),\n    filenameRelative: filerelative,\n    sourceFileName: filerelative,\n    sourceMapTarget: filerelative\n  })\n\n  /**\n   * Transform via babel.\n   */\n  const output = babel.transform(data.body, options)\n\n  /**\n   * Write sourcemap.\n   */\n  if (options.sourceMaps) {\n    await new Promise((resolve, reject) => {\n      fs.writeFile(data.dest + '.map', JSON.stringify(output.map), err => {\n        if (err) reject(err)\n        else resolve()\n      })\n    })\n  }\n\n  /**\n   * Replace code.\n   */\n  data.body = output.code\n\n  /**\n   * Add sourcemap link.\n   */\n  if (options.sourceMaps) {\n    data.body += `\\n\\n//# sourceMappingURL=${path.basename(data.dest)}.map`\n  }\n\n  /**\n   * Return final object.\n   */\n  return data\n}\n"]}